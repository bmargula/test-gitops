# --- GLOBAL ---
cluster:
  name: aks-zeiss-lab

# --- ZIELE (Destinations) ---
# In v3 definieren wir hier, wo die Daten hingehen.
destinations:
  - name: loki
    type: loki
    url: http://loki-gateway.monitoring.svc.cluster.local/loki/api/v1/push

  - name: mimir
    type: prometheus
    url: http://mimir-gateway.monitoring.svc.cluster.local/api/v1/push

  - name: tempo
    type: otlp
    url: http://tempo-distributor.monitoring.svc.cluster.local:4317
    protocol: grpc

# --- FEATURES (Was sammeln wir?) ---

# 1. Logs (Neu: podLogs statt logs)
podLogs:
  enabled: true

# 2. Events (Neu: clusterEvents)
clusterEvents:
  enabled: true

# 3. Metriken (Neu: clusterMetrics statt metrics)
clusterMetrics:
  enabled: true
  kubelet:
    enabled: true
    client:
      tls:
        insecureSkipVerify: true # AKS Fix
  cadvisor:
    enabled: true
    client:
      tls:
        insecureSkipVerify: true # AKS Fix
  kube-state-metrics:
    podAnnotations:
      kubernetes.azure.com/set-kube-service-host-fqdn: "true"

# 4. Tracing (Die "App of Apps" für Traces)
# WICHTIG: Wir deaktivieren das Feature "traces" (Cluster Traces),
# und nutzen nur "applicationObservability" (App Traces).
traces:
  enabled: false

applicationObservability:
  enabled: true
  receivers:
    otlp:
      grpc:
        enabled: true
        port: 4317
      http:
        enabled: true
        port: 4318

# --- COLLECTORS (Die Pods) ---
# Hier müssen wir die AKS-Annotationen setzen, damit die Pods mit der API reden können.

alloy-singleton:
  enabled: true
  controller:
    podAnnotations:
      kubernetes.azure.com/set-kube-service-host-fqdn: "true"

alloy-logs:
  enabled: true
  controller:
    podAnnotations:
      kubernetes.azure.com/set-kube-service-host-fqdn: "true"

alloy-metrics:
  enabled: true
  controller:
    podAnnotations:
      kubernetes.azure.com/set-kube-service-host-fqdn: "true"

alloy-receiver:
  enabled: true
  controller:
    podAnnotations:
      kubernetes.azure.com/set-kube-service-host-fqdn: "true"
